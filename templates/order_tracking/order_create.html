{% extends "base/_base_in_product.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
    <form action="" method="post" class="bootstrap5" enctype="multipart/form-data">
        {% csrf_token %}
        {% crispy form %}
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
{% endblock content %}

{% block script %}
    <script>
        // Get the checkbox and the fields to be disabled
        let clientExistsSelector = document.querySelector('#id_client_already_exists');
        let clientSelector = document.querySelector('#id_client');

        let fieldsToDisableUser = [
            document.querySelector('#id_first_name'),
            document.querySelector('#id_last_name'),
            document.querySelector('#id_email'),
            document.querySelector('#id_phone_number'),
        ];


        // Function to toggle the disabled attribute on fields
        function toggleFieldsDisabled() {
            let isClientExists = clientExistsSelector.value === 'True';

            {# Disabling/Enabling Client Fields (Name/Phone/Email) #}
            fieldsToDisableUser.forEach(field => {field.disabled = isClientExists;});
            {# Enabling/Disabling the Client Selector #}
            clientSelector.disabled = !isClientExists;

            {# If we set Existing Client? to No -> Set the Client Selector to nothing #}
            if (!isClientExists) {
                clientSelector.value = '';
            }
        }

        // Initially set the field states and add an event listener
        toggleFieldsDisabled();
        clientExistsSelector.addEventListener('change', toggleFieldsDisabled);
    </script>
{% endblock script %}